\makeatletter
\newcommand\resetstackedplots{
\makeatletter
\pgfplots@stacked@isfirstplottrue
\makeatother
\addplot [forget plot,draw=none] coordinates{(Skin,0) (Diabetes,0) (Tic-Tac-Toe,0) (Breast-w,0) (Credit-g,0 )(Higgs,0) (Nomao,0) (Balance-Scale,0) (Walking-Activity,0) (Jungle-Chess,0) (CMC,0) (Traffic,0) (Gas-Drift,0) (Volkert,0) (Black-Friday,0) (Bike-Sharing,0)(NYC,0) (House-Sales,0)};
}
\makeatother

\begin{tikzpicture}
    \newcommand{\addplotOverAll}[4]{        
        \addplot[xshift=#4,fill=#3,draw=black,discard if single={#1}, line width=0.2pt]
        table[ y=#2, col sep=comma, x=dataset_name] {../archive/SIGMOD2025-Results/OverallResults.csv};
        \label{#2}
    };   
   
    \newcommand{\myaddplotllm}[1]{
      \resetstackedplots
      \addplotOverAll{#1}{CatDB}{tugb}{-3.5pt};
      \resetstackedplots
      \addplotOverAll{#1}{CatDBChain}{tug}{0pt};
      \resetstackedplots
      \addplotOverAll{#1}{max_other}{black}{3.5pt};      
    };

    \pgfplotsset{
        discard if single/.style n args={1}{
            x filter/.code={
                \edef\tempa{\thisrow{llm_model}}
                \edef\tempb{#1}
                \ifx\tempa\tempb
                \else
                \def\pgfmathresult{inf}
                \fi
            }
        }
    };
   

\begin{axis}[
  ybar stacked,
  ymin=0,
  ymax=100,
  y tick label style={/pgf/number format/1000 sep={}},
  x tick label style={/pgf/number format/1000 sep={}},  
  scaled y ticks=false,
  axis line style={black, line width=0.3pt},
  enlarge y limits={0.35,upper},
  enlarge x limits=0.03,
  ylabel={AUC/AUC-over/$R^2$ [\%]},
  xlabel={$\#$ Dataset},
  log ticks with fixed point,
  xtick align=outside,
  xtick pos=left,
  ytick pos=left,
  yticklabel style = {font=\normalsize},
  ylabel style = {font=\normalsize, yshift=-6pt, xshift=-4pt},
  height=.5\columnwidth,
  width=1.3\columnwidth,
  ymajorgrids=true,
  grid style=dotted,
  minor grid style={gray!70},
  every axis plot/.append style={line width=0.4pt,mark options={scale=1.5,solid}},  
  xticklabel style = {font=\normalsize, xshift=0pt, yshift=4pt},
  legend image post style={line width=.5pt},          
  bar width=3.5pt,         
  % ytick={0,20,40,60,80,100},
  % yticklabels={0, 20, 40, 60, 80, 100},               
  every x tick/.style={ draw=none},
  xtick = data,
  symbolic x coords={Skin,Diabetes,Tic-Tac-Toe,Breast-w,Credit-g,Higgs,Nomao,Balance-Scale,Walking-Activity,Jungle-Chess,CMC,Traffic,Gas-Drift,Volkert,Black-Friday,Bike-Sharing,NYC,House-Sales},
  xticklabels={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18},
  legend image code/.code={\draw [#1] (0cm,-0.1cm) rectangle (0.15cm,0.1cm); }, 
]
\myaddplotllm{gemini-1.5-pro-latest}
\end{axis}

\node [draw=none,inner sep=0, font=\footnotesize, anchor=west] (leg1) at (rel axis cs: 0.06,0.9) {\shortstack[l]{
  \ref{CatDB} CatDB \ \ \ref{CatDBChain} CatDB Chain \ \ \ref{max_other} Maximum Performance of Baselines (CAAFE \& AutoML)
  }};

\end{tikzpicture}
